#!/bin/sh
#
# Runs multiple Python static checkers.
#

FILE=$1

checkpath() {
    # Return True if $1 is in ${PATH}.
    IFS=':'
    for dir in $PATH ; do
        if [ -x "$dir/$1" ]; then
           return 0
        fi
    done
    return 1
}

if checkpath pep8; then
    echo "## pep8"
    # E202 whitespace before ')'
    pep8 --ignore=E202 --repeat ${FILE}
else
    echo "## pep8 not installed"
fi

if checkpath pyflakes; then
    echo "## pyflakes"
    pyflakes ${FILE}
else
    echo "## pyflakes not installed"
fi

if checkpath pychecker; then
    # pychecker raises an ImportError if the file does not end in ".py".
    if [ ${FILE%.py} != ${FILE} ]; then
        echo "## pychecker"
        pychecker ${FILE}
        # Cleanup generated bytecode file.
        if [ -f ${FILE}c ]; then
            rm ${FILE}c
        fi
    else
        echo "## pychecker not run because input file does not have .py suffix."
    fi
else
    echo "## pychecker not installed"
fi

if checkpath pylint; then
    echo "## pylint"
    pylint ${FILE}
else
    echo "## pylint not installed"
fi
