# Alias, function, and prompt definitions for Bourne-derived shells.
# Sourced by .${SHELL}rc

# Aliases.

# lynx(1) writes to .lynxrc, so we use an aliases instead.
if [ -x "/usr/bin/lynx" -o -x "/usr/local/bin/lynx" ]; then
    alias lynx="lynx -accept_all_cookies"
fi

# We don't set the LESS environment variable, because that applies to
# PAGER usage (think man).
if [ -x "/usr/bin/less" -o -x "/usr/local/bin/less" ]; then
    alias more="less --no-init --quit-at-eof --LONG-PROMPT"
    alias less="less --no-init --quit-at-eof --LONG-PROMPT"
fi

if [ "${_UNAME}" = "CYGWIN_NT" ]; then
    # -W: show windows as well as cygwin processes
    alias ps="ps -W"
fi

# Enable color support in various programs.
if [ -x /usr/bin/dircolors ]; then
    test -r ~/.dircolors && eval "$(dircolors -b ~/.dircolors)" || eval "$(dircolors -b)"
    alias ls="ls --color=auto"
    alias dir="dir --color=auto -lb"  # -b = C-style escapes for nongraphic characters
    alias grep="grep --color=auto"
else
    if [ "${_UNAME}" = "OpenBSD" ]; then
        alias dir="/bin/ls -l"
    else
        alias dir="/bin/ls -lb"  # -b = C-style escapes for nongraphic characters
    fi
fi

# Functions.
_cdhelper() {
    CMD="cd $1"
    shift
    for ARG in $*; do
        CMD=${CMD}/${ARG}
    done
    eval ${CMD}
}
home() {
    _cdhelper ${HOME} $*
}
src() {
    _cdhelper ${SRC} $*
}
u() {
    _cdhelper .. $*
}
uu() {
    _cdhelper ../.. $*
}
uuu() {
    _cdhelper ../../.. $*
}
uuuu() {
    _cdhelper ../../../.. $*
}

# Prompt.
# Determine the hostname.
_HOSTNAME=`hostname | /usr/bin/tr '[A-Z]' '[a-z]'`  # Convert to lowercase.
_HOSTNAME=${_HOSTNAME%%.*}  # Strip any domain suffix.
export _HOSTNAME

# _PS1_PREFIX can be optionally set in .bashrc-local or .kshrc-local
# to indicate the type of machine.  For example:
#     case ${_HOSTNAME} in
#         firewall)
#             _PS1_PREFIX='\[\e[1;31m\]FW\[\e[0m\] ' # bright red
#             ;;
#     esac

# Define some prompt strings.
# \[ begin a sequence of non-printing characters
# \] end a sequence of non-printing characters
# \a an ASCII bell character (007)
# \e an ASCII escape character (033)
# \t the current time in 24-hour HH:MM:SS format
# \w the current working directory, with $HOME abbreviated with a tilde
# \$ if the effective UID is 0, a #, otherwise a $
# \e]0;STRING\a sets the icon name and window title to STRING
ps1-default() {
    # Default prompt string.
    if [ "${EMACS}" != "t" ]; then
        PS1='\[\e]0;${_HOSTNAME}:\w\a\]'${_PS1_PREFIX}${_HOSTNAME}':\w\$ '
    fi
}
ps1-time() {
    # Prompt string with timestamp.  Useful if you want to know when a
    # command was run.
    if [ "${EMACS}" != "t" ]; then
        PS1='\[\e]0;${_HOSTNAME}:\w\a\]\t '${_PS1_PREFIX}${_HOSTNAME}':\w\$ '
    fi
}
ps1-history() {
    # Prompt string with history numbers.
    if [ "${EMACS}" != "t" ]; then
        PS1='\[\e]0;${_HOSTNAME}:\w\a\]\!:'${_PS1_PREFIX}${_HOSTNAME}':\w\$ '
    fi
}

# Select the default prompt string.
ps1-default

# Set the window title to a default value when running ssh.  If the
# target machine is configured correctly, it will immediately set the
# window title back to something useful.
#
# The [ -t 1 ] test determines if we are being called from a terminal.
# If this ssh is part of a pipe, then we don't want to inject the
# control sequence into the output stream.  Fixes bash-completion of
# scp filenames.
alias ssh="[ -t 1 ] && echo -ne '\033]0;ssh\007' ; ssh"

# Local Variables:
# mode:sh
# End:
